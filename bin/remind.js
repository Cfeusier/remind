!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("babel-polyfill"),require("babel-runtime/core-js/json/stringify"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("fs"),require("path"),require("http"),require("yargs"),require("ramda"),require("twilio"),require("cron")):"function"==typeof define&&define.amd?define("remind",["babel-polyfill","babel-runtime/core-js/json/stringify","babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","fs","path","http","yargs","ramda","twilio","cron"],r):"object"==typeof exports?exports.remind=r(require("babel-polyfill"),require("babel-runtime/core-js/json/stringify"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("fs"),require("path"),require("http"),require("yargs"),require("ramda"),require("twilio"),require("cron")):e.remind=r(e["babel-polyfill"],e["babel-runtime/core-js/json/stringify"],e["babel-runtime/helpers/classCallCheck"],e["babel-runtime/helpers/createClass"],e.fs,e.path,e.http,e.yargs,e.ramda,e.twilio,e.cron)}(this,function(e,r,i,t,n,s,o,l,u,a,_){return function(e){function r(t){if(i[t])return i[t].exports;var n=i[t]={exports:{},id:t,loaded:!1};return e[t].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var i={};return r.m=e,r.c=i,r.p="",r(0)}([function(e,r,i){i(1),e.exports=i(2)},function(e,r){e.exports=require("babel-polyfill")},function(e,r,i){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var n=i(3),s=t(n),o=i(4),l=t(o),u=i(5),a=t(u),_=i(6),d=t(_),f=i(7),h=t(f),c=i(8),m=t(c),p=i(9),b=i(10),y=t(b),g=i(11),v=t(g),q=i(12),w={h:36e5,min:6e4,mon:2592e6,y:31536e6,d:864e5},k="America/Los_Angeles",x="* * * * * *",j="http://api.icndb.com/jokes/random?firstName=Roger&lastName=Feus",C=function(){function e(){(0,l["default"])(this,e),this.__twilio=null,this.__fetch()}return(0,a["default"])(e,[{key:"__fetch",value:function(){try{var e=JSON.parse(d["default"].readFileSync(h["default"].resolve("bin/reminders.json"),"utf8"));this.__reminders=e.reminders,this.__sent=e.sent,this.__lubo=e.lubo,this.__config=e.config}catch(r){d["default"].writeFileSync(h["default"].resolve("reminders.json"),(0,s["default"])({reminders:[],sent:[],lubo:{},config:{}})),this.__reminders=[],this.__sent=[],this.__lubo={},this.__config={}}}},{key:"__payload",value:function(){return{reminders:this.__reminders,sent:this.__sent,lubo:this.__lubo,config:this.__config}}},{key:"__reminder",value:function(e){return{to:"+"+this.__config.phone,from:"+"+this.__config.twilioPhone,body:e}}},{key:"__write",value:function(e){d["default"].writeFile(h["default"].resolve("reminders.json"),(0,s["default"])(this.__payload()),function(r){if(r)throw Error("Error adding reminder -- please try again");e&&e()})}},{key:"__handleFailure",value:function(e){if(e)throw Error("Error sending reminder with id: "+reminder.id)}},{key:"__triggerSMS",value:function(e){this.__twilio.sendMessage(this.__reminder.call(this,e.reminder),this.__handleFailure.bind(this))}},{key:"__send",value:function(){if(this.__reminders.length){var e=this.__config.every?this.__config.every:"h",r=w[e],i=Date.now();if(this.__lubo.ts){var t=i-this.__lubo.ts;if(t>=r){var n=this.__reminders.pop();this.__sent.push(n),this.__lubo.ts=Date.now(),this.__triggerSMS(n)}}else{var s=this.__reminders.pop();this.__sent.push(s),this.__lubo.ts=Date.now(),this.__triggerSMS(s)}}else if(this.__reminders=this.__sent.slice(),this.__sent=[],!this.__reminders.length)throw Error("Error sending reminders -- must add a reminder first")}},{key:"__activate",value:function(e){this.__twilio=(0,v["default"])(e.twilioSID,e.twilioToken),this.__config=y["default"].omit(["twilioSID","twilioToken"],e);var r=new q.CronJob(x,this.__send.bind(this),null,!1,k);this.__write(r.start.bind(r))}},{key:"__add",value:function(e){var r=this;if(e.reminder){if(y["default"].find(y["default"].propEq("id",e.id),this.__reminders))return;"__random__"===e.reminder?m["default"].get(j,function(i){var t="";i.on("data",function(e){t+=e}),i.on("end",function(){var i=JSON.parse(t);if("success"===i.type){var n={id:e.id,tag:"joke",reminder:i.value.joke};r.__reminders.push(n),r.__write()}})}):(this.__reminders.push(e),this.__write())}}},{key:"__remove",value:function(e){var r=y["default"].findIndex(y["default"].propEq("id",e),this.__reminders);r>-1?(this.__reminders.splice(r,1),this.__write(),console.log("Successfully removed reminder with id: "+e)):console.log("No reminder found with id: "+e)}},{key:"__routeCommands",value:function(e,r,i){e&&e.phone&&e.twilioSID&&e.twilioToken&&e.twilioPhone&&this.__activate(e),r&&this.__add(r),i&&this.__remove(i.id)}},{key:"run",value:function(){this.__routeCommands(p.argv.on,p.argv.add,p.argv.remove)}}]),e}();r["default"]=C},function(e,r){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,r){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,r){e.exports=require("babel-runtime/helpers/createClass")},function(e,r){e.exports=require("fs")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("http")},function(e,r){e.exports=require("yargs")},function(e,r){e.exports=require("ramda")},function(e,r){e.exports=require("twilio")},function(e,r){e.exports=require("cron")}])});
//# sourceMappingURL=remind.js.map